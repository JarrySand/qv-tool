# QV-Tool é–‹ç™ºå¼•ãç¶™ãè³‡æ–™

## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

**Quadratic Voting Tool (QV-Tool)** ã¯ã€äºŒæ¬¡æŠ•ç¥¨ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’ç”¨ã„ãŸæ°‘ä¸»çš„ãªæ„æ€æ±ºå®šãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚

### ç¾åœ¨ã®çŠ¶æ…‹

- **Phase 1: åŸºç›¤æ§‹ç¯‰** âœ… å®Œäº†
- **Phase 2: èªè¨¼ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†** âœ… å®Œäº†
- **Phase 3: æŠ•ç¥¨æ©Ÿèƒ½** âœ… å®Œäº†
- **Phase 4: é›†è¨ˆãƒ»çµæœè¡¨ç¤º** âœ… å®Œäº†
- **Phase 5: å“è³ªå‘ä¸Šãƒ»æœ€é©åŒ–** âœ… å®Œäº†

---

## 2. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| ã‚«ãƒ†ã‚´ãƒª   | æŠ€è¡“                     | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ |
| ---------- | ------------------------ | ---------- |
| Framework  | Next.js (App Router)     | 16.0.4     |
| Language   | TypeScript               | ^5         |
| Styling    | Tailwind CSS + Shadcn/ui | v4         |
| Database   | PostgreSQL               | 16-alpine  |
| ORM        | Prisma                   | 7.0.1      |
| Validation | Zod                      | ^4.1.13    |
| Auth       | NextAuth.js (v5)         | 5.0.0-beta |
| Test       | Vitest + Playwright      | å°å…¥æ¸ˆã¿   |

---

## 3. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
qv-tool/
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma          # DBã‚¹ã‚­ãƒ¼ãƒå®šç¾©
â”‚   â””â”€â”€ migrations/            # ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å±¥æ­´
â”œâ”€â”€ messages/
â”‚   â”œâ”€â”€ en.json                # è‹±èªãƒªã‚½ãƒ¼ã‚¹ â­
â”‚   â””â”€â”€ ja.json                # æ—¥æœ¬èªãƒªã‚½ãƒ¼ã‚¹ â­
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ (auth)/
â”‚   â”‚   â”‚   â””â”€â”€ auth/
â”‚   â”‚   â”‚       â”œâ”€â”€ signin/    # ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ â­
â”‚   â”‚   â”‚       â””â”€â”€ error/     # èªè¨¼ã‚¨ãƒ©ãƒ¼ãƒšãƒ¼ã‚¸ â­
â”‚   â”‚   â”œâ”€â”€ (dashboard)/
â”‚   â”‚   â”‚   â””â”€â”€ admin/
â”‚   â”‚   â”‚       â”œâ”€â”€ create/    # ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆãƒšãƒ¼ã‚¸ â­
â”‚   â”‚   â”‚       â”œâ”€â”€ created/   # ä½œæˆå®Œäº†ãƒšãƒ¼ã‚¸ â­
â”‚   â”‚   â”‚       â””â”€â”€ [id]/      # ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†ãƒšãƒ¼ã‚¸ â­
â”‚   â”‚   â”œâ”€â”€ events/
â”‚   â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚       â”œâ”€â”€ page.tsx       # ã‚¤ãƒ™ãƒ³ãƒˆå…¬é–‹ãƒšãƒ¼ã‚¸ â­
â”‚   â”‚   â”‚       â”œâ”€â”€ vote/          # æŠ•ç¥¨ç”»é¢ â­
â”‚   â”‚   â”‚       â”œâ”€â”€ complete/      # æŠ•ç¥¨å®Œäº†ç”»é¢ â­
â”‚   â”‚   â”‚       â””â”€â”€ result/        # çµæœç”»é¢ â­
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â””â”€â”€ auth/
â”‚   â”‚   â”‚       â””â”€â”€ [...nextauth]/ # NextAuth API â­
â”‚   â”‚   â”œâ”€â”€ error.tsx          # ã‚¨ãƒ©ãƒ¼ãƒã‚¦ãƒ³ãƒ€ãƒª â­
â”‚   â”‚   â”œâ”€â”€ global-error.tsx   # ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ â­
â”‚   â”‚   â”œâ”€â”€ not-found.tsx      # 404ãƒšãƒ¼ã‚¸ â­
â”‚   â”‚   â”œâ”€â”€ globals.css
â”‚   â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”‚   â””â”€â”€ page.tsx           # ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ui/                # Shadcn/ui ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ features/          # æ©Ÿèƒ½ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ event-create-form.tsx     â­
â”‚   â”‚   â”‚   â”œâ”€â”€ event-created-content.tsx â­
â”‚   â”‚   â”‚   â”œâ”€â”€ event-admin-content.tsx   â­
â”‚   â”‚   â”‚   â”œâ”€â”€ event-edit-dialog.tsx     â­
â”‚   â”‚   â”‚   â”œâ”€â”€ subject-list.tsx          â­
â”‚   â”‚   â”‚   â”œâ”€â”€ access-token-manager.tsx  â­
â”‚   â”‚   â”‚   â”œâ”€â”€ voting-interface.tsx      â­
â”‚   â”‚   â”‚   â”œâ”€â”€ results-chart.tsx         â­
â”‚   â”‚   â”‚   â”œâ”€â”€ statistics-card.tsx       â­
â”‚   â”‚   â”‚   â”œâ”€â”€ vote-distribution-chart.tsx â­
â”‚   â”‚   â”‚   â”œâ”€â”€ live-result-container.tsx â­
â”‚   â”‚   â”‚   â”œâ”€â”€ csv-export-buttons.tsx    â­
â”‚   â”‚   â”‚   â””â”€â”€ language-switcher.tsx     â­
â”‚   â”‚   â””â”€â”€ layout/
â”‚   â”œâ”€â”€ i18n/
â”‚   â”‚   â”œâ”€â”€ config.ts          # i18nè¨­å®š â­
â”‚   â”‚   â””â”€â”€ request.ts         # ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç† â­
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ actions/
â”‚   â”‚   â”‚   â”œâ”€â”€ event.ts       # ã‚¤ãƒ™ãƒ³ãƒˆServer Actions â­
â”‚   â”‚   â”‚   â”œâ”€â”€ subject.ts     # æŠ•ç¥¨å¯¾è±¡Server Actions â­
â”‚   â”‚   â”‚   â”œâ”€â”€ access-token.ts # ãƒˆãƒ¼ã‚¯ãƒ³Server Actions â­
â”‚   â”‚   â”‚   â”œâ”€â”€ vote.ts        # æŠ•ç¥¨Server Actions â­
â”‚   â”‚   â”‚   â”œâ”€â”€ result.ts      # çµæœé›†è¨ˆServer Actions â­
â”‚   â”‚   â”‚   â””â”€â”€ locale.ts      # ãƒ­ã‚±ãƒ¼ãƒ«Server Actions â­
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”œâ”€â”€ line-provider.ts   # LINE OIDCãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ â­
â”‚   â”‚   â”‚   â””â”€â”€ voting-auth.ts     # æŠ•ç¥¨è€…èªè¨¼ãƒ˜ãƒ«ãƒ‘ãƒ¼ â­
â”‚   â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”‚   â”œâ”€â”€ qv.ts          # QVè¨ˆç®—
â”‚   â”‚   â”‚   â”œâ”€â”€ qv.test.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ slug.ts        # ã‚¹ãƒ©ãƒƒã‚°ç”Ÿæˆ â­
â”‚   â”‚   â”‚   â”œâ”€â”€ slug.test.ts
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ utils.ts
â”‚   â”‚   â””â”€â”€ validations/
â”‚   â”‚       â”œâ”€â”€ event.ts       # ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ â­
â”‚   â”‚       â”œâ”€â”€ event.test.ts
â”‚   â”‚       â”œâ”€â”€ subject.ts     # æŠ•ç¥¨å¯¾è±¡ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ â­
â”‚   â”‚       â”œâ”€â”€ vote.ts        # æŠ•ç¥¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ â­
â”‚   â”‚       â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ test/
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â””â”€â”€ next-auth.d.ts     # NextAuthå‹æ‹¡å¼µ â­
â”‚   â””â”€â”€ auth.ts                # NextAuthè¨­å®š â­
â”œâ”€â”€ e2e/                       # E2Eãƒ†ã‚¹ãƒˆ â­
â”‚   â”œâ”€â”€ home.spec.ts
â”‚   â”œâ”€â”€ event-create.spec.ts
â”‚   â””â”€â”€ voting-flow.spec.ts
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ DEPLOY.md              # ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †æ›¸ â­
â”‚   â””â”€â”€ USER_MANUAL.md         # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ‹ãƒ¥ã‚¢ãƒ« â­
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ vercel.json                # Vercelè¨­å®š â­
â”œâ”€â”€ CONTRIBUTING.md            # ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚¬ã‚¤ãƒ‰ â­
â”œâ”€â”€ development-plan.md
â””â”€â”€ system-specification.md
```

---

## 4. ç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# 1. ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# 2. ç’°å¢ƒå¤‰æ•°è¨­å®š
cp .env.example .env
# .env ã‚’ç·¨é›†

# 3. DBã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•
docker-compose up -d

# 4. Prisma Clientç”Ÿæˆ & ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
npx prisma generate
npx prisma migrate dev

# 5. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
npm run dev
```

### ä¸»è¦ã‚³ãƒãƒ³ãƒ‰

| ã‚³ãƒãƒ³ãƒ‰             | èª¬æ˜                 |
| -------------------- | -------------------- |
| `npm run dev`        | é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•     |
| `npm run build`      | ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰ |
| `npm run lint`       | ESLintå®Ÿè¡Œ           |
| `npm run format`     | Prettierå®Ÿè¡Œ         |
| `npm run type-check` | TypeScriptãƒã‚§ãƒƒã‚¯   |
| `npm run test`       | å˜ä½“ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ       |
| `npm run test:e2e`   | E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œ        |
| `npm run db:studio`  | Prisma Studioèµ·å‹•    |
| `npm run db:migrate` | ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ |

---

## 5. Phase 2 å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½

### 5.1 èªè¨¼ã‚·ã‚¹ãƒ†ãƒ 

**NextAuth.js v5 (Auth.js)**

- JWTã‚»ãƒƒã‚·ãƒ§ãƒ³æˆ¦ç•¥
- PrismaAdapterã«ã‚ˆã‚‹DBé€£æº
- ã‚«ã‚¹ã‚¿ãƒ ã‚µã‚¤ãƒ³ã‚¤ãƒ³/ã‚¨ãƒ©ãƒ¼ãƒšãƒ¼ã‚¸

**Google OAuth**

- ç’°å¢ƒå¤‰æ•°: `GOOGLE_CLIENT_ID`, `GOOGLE_CLIENT_SECRET`
- è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«: `src/auth.ts`

**LINE OpenID Connect**

- ç’°å¢ƒå¤‰æ•°: `LINE_CHANNEL_ID`, `LINE_CHANNEL_SECRET`
- ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼: `src/lib/auth/line-provider.ts`

**å€‹åˆ¥æŠ•ç¥¨èªè¨¼**

- AccessTokenãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†
- èªè¨¼ãƒ˜ãƒ«ãƒ‘ãƒ¼: `src/lib/auth/voting-auth.ts`
  - `authenticateVoter()`: æŠ•ç¥¨è€…èªè¨¼
  - `checkVoteStatus()`: æŠ•ç¥¨çŠ¶æ³ç¢ºèª
  - `getEventAuthRequirement()`: ã‚¤ãƒ™ãƒ³ãƒˆèªè¨¼è¦ä»¶å–å¾—

### 5.2 ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†æ©Ÿèƒ½

**ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆ**

- ãƒ•ã‚©ãƒ¼ãƒ UI: `src/components/features/event-create-form.tsx`
- Server Action: `src/lib/actions/event.ts`
  - adminTokenè‡ªå‹•ç”Ÿæˆ
  - slugè‡ªå‹•/æ‰‹å‹•ç”Ÿæˆ

**ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†ãƒšãƒ¼ã‚¸**

- URL: `/admin/[id]?token=<adminToken>`
- æ©Ÿèƒ½:
  - ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±è¡¨ç¤ºãƒ»ç·¨é›†
  - æŠ•ç¥¨å¯¾è±¡ï¼ˆSubjectï¼‰ã®CRUD
  - å€‹åˆ¥æŠ•ç¥¨ãƒˆãƒ¼ã‚¯ãƒ³ã®ç”Ÿæˆãƒ»CSVå‡ºåŠ›
  - æŠ•ç¥¨é–‹å§‹å¾Œã®ç·¨é›†åˆ¶é™

### 5.3 æŠ•ç¥¨å¯¾è±¡ç®¡ç†

- Subjectä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤
- ç”»åƒURLå¯¾å¿œï¼ˆå¤–éƒ¨URLï¼‰
- è¡¨ç¤ºé †åºç®¡ç†ï¼ˆorderãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼‰

### 5.4 å€‹åˆ¥æŠ•ç¥¨ç”¨ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†

- ãƒˆãƒ¼ã‚¯ãƒ³ä¸€æ‹¬ç”Ÿæˆï¼ˆ1ã€œ100ä»¶ï¼‰
- CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- ä½¿ç”¨çŠ¶æ³ã®è¡¨ç¤º

---

## 6. Phase 3 å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½

### 6.1 ã‚¤ãƒ™ãƒ³ãƒˆå…¬é–‹ãƒšãƒ¼ã‚¸

- URL: `/events/[id]` ã¾ãŸã¯ `/events/[slug]`
- æ©Ÿèƒ½:
  - ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±ã®è¡¨ç¤ºï¼ˆã‚¿ã‚¤ãƒˆãƒ«ã€èª¬æ˜ã€æœŸé–“ã€ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆæ•°ï¼‰
  - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ï¼ˆé–‹å‚¬å‰/é–‹å‚¬ä¸­/çµ‚äº†ï¼‰
  - æŠ•ç¥¨å¯¾è±¡ä¸€è¦§ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
  - èªè¨¼çŠ¶æ…‹ã«å¿œã˜ãŸæŠ•ç¥¨ãƒœã‚¿ãƒ³è¡¨ç¤º
  - æŠ•ç¥¨æ¸ˆã¿çŠ¶æ…‹ã®è¡¨ç¤º

### 6.2 QVè¨ˆç®—ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£

- ãƒ•ã‚¡ã‚¤ãƒ«: `src/lib/utils/qv.ts`
- é–¢æ•°:
  - `calculateCost()`: ç¥¨æ•°ã‹ã‚‰ã‚³ã‚¹ãƒˆè¨ˆç®—
  - `calculateMaxVotes()`: ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‹ã‚‰æœ€å¤§ç¥¨æ•°è¨ˆç®—
  - `calculateTotalCost()`: ç·ã‚³ã‚¹ãƒˆè¨ˆç®—
  - `calculateRemainingCredits()`: æ®‹ã‚Šã‚¯ãƒ¬ã‚¸ãƒƒãƒˆè¨ˆç®—
  - `calculateMaxAdditionalVotes()`: è¿½åŠ æŠ•ç¥¨å¯èƒ½æ•°è¨ˆç®—
  - `canChangeVote()`: æŠ•ç¥¨å¤‰æ›´å¯å¦ãƒã‚§ãƒƒã‚¯

### 6.3 æŠ•ç¥¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

- ãƒ•ã‚¡ã‚¤ãƒ«: `src/components/features/voting-interface.tsx`
- æ©Ÿèƒ½:
  - æŠ•ç¥¨å¯¾è±¡ä¸€è¦§ã®è¡¨ç¤ºï¼ˆç”»åƒã€èª¬æ˜ã€URLï¼‰
  - ã€Œ+ã€ã€Œ-ã€ãƒœã‚¿ãƒ³ã«ã‚ˆã‚‹æŠ•ç¥¨æ•°èª¿æ•´
  - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆè¨ˆç®—ãƒ»ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼
  - å„å¯¾è±¡ã®ã‚³ã‚¹ãƒˆè¡¨ç¤º
  - ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆè¶…éæ™‚ã®ãƒœã‚¿ãƒ³ç„¡åŠ¹åŒ–

### 6.4 æŠ•ç¥¨é€ä¿¡å‡¦ç†

- ãƒ•ã‚¡ã‚¤ãƒ«: `src/lib/actions/vote.ts`
- Server Actions:
  - `submitVote()`: æŠ•ç¥¨ã®æ–°è¦ä½œæˆã¾ãŸã¯æ›´æ–°
  - `getExistingVote()`: æ—¢å­˜æŠ•ç¥¨ãƒ‡ãƒ¼ã‚¿ã®å–å¾—
- ç‰¹å¾´:
  - Prismaãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§
  - å€‹åˆ¥ãƒˆãƒ¼ã‚¯ãƒ³/Socialèªè¨¼ã®ä¸¡æ–¹ã«å¯¾å¿œ
  - æŠ•ç¥¨æœŸé–“ãƒ»ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆè¶…éã®ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰æ¤œè¨¼

### 6.5 æŠ•ç¥¨å®Œäº†ãƒšãƒ¼ã‚¸

- URL: `/events/[id]/complete`
- æ©Ÿèƒ½:
  - æŠ•ç¥¨å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  - çµæœãƒšãƒ¼ã‚¸ã¸ã®ãƒªãƒ³ã‚¯
  - æŠ•ç¥¨å¤‰æ›´ãƒšãƒ¼ã‚¸ã¸ã®ãƒªãƒ³ã‚¯

### 6.6 å†æŠ•ç¥¨æ©Ÿèƒ½

- æŠ•ç¥¨æœŸé–“å†…ã§ã‚ã‚Œã°ä½•åº¦ã§ã‚‚æŠ•ç¥¨å†…å®¹ã‚’å¤‰æ›´å¯èƒ½
- æ—¢å­˜æŠ•ç¥¨ãƒ‡ãƒ¼ã‚¿ã®è‡ªå‹•èª­ã¿è¾¼ã¿
- VoteDetailã®ä¸Šæ›¸ãæ›´æ–°

---

## 7. Phase 4 å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½

### 7.1 çµæœè¡¨ç¤ºãƒšãƒ¼ã‚¸

- URL: `/events/[id]/result` ã¾ãŸã¯ `/events/[slug]/result`
- æ©Ÿèƒ½:
  - å„æŠ•ç¥¨å¯¾è±¡ã®å¾—ç¥¨æ•°è¡¨ç¤ºï¼ˆæ£’ã‚°ãƒ©ãƒ•ï¼‰
  - ãƒ©ãƒ³ã‚­ãƒ³ã‚°å½¢å¼ã®è©³ç´°çµæœè¡¨ç¤º
  - æŠ•ç¥¨åˆ†å¸ƒãƒãƒ£ãƒ¼ãƒˆï¼ˆå„é¸æŠè‚¢ã¸ã®ç¥¨æ•°åˆ†å¸ƒï¼‰
  - é–‹å‚¬ä¸­ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ï¼ˆ10ç§’ãƒãƒ¼ãƒªãƒ³ã‚°ï¼‰

### 7.2 çµ±è¨ˆæƒ…å ±

- ç·å‚åŠ è€…æ•°
- ç·æ¶ˆè²»ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ / åˆ©ç”¨å¯èƒ½ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ
- å¹³å‡æ¶ˆè²»ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ
- å‚åŠ ç‡ï¼ˆå€‹åˆ¥æŠ•ç¥¨ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆï¼‰/ ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆæ¶ˆè²»ç‡

### 7.3 CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

- é›†è¨ˆãƒ‡ãƒ¼ã‚¿: é †ä½ãƒ»ã‚¿ã‚¤ãƒˆãƒ«ãƒ»å¾—ç¥¨æ•°ãƒ»æ¶ˆè²»ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆãƒ»æŠ•ç¥¨è€…æ•°
- ãƒ­ãƒ¼ãƒ‡ãƒ¼ã‚¿: å€‹åˆ¥æŠ•ç¥¨ãƒ‡ãƒ¼ã‚¿ï¼ˆç®¡ç†è€…ãƒˆãƒ¼ã‚¯ãƒ³å¿…é ˆï¼‰
- BOMä»˜ãCSVã§Excelå¯¾å¿œ

### 7.4 ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«

- `src/app/events/[id]/result/page.tsx` - çµæœè¡¨ç¤ºãƒšãƒ¼ã‚¸
- `src/lib/actions/result.ts` - çµæœé›†è¨ˆServer Actions
- `src/components/features/results-chart.tsx` - å¾—ç¥¨ã‚°ãƒ©ãƒ•ï¼ˆRechartsï¼‰
- `src/components/features/statistics-card.tsx` - çµ±è¨ˆæƒ…å ±ã‚«ãƒ¼ãƒ‰
- `src/components/features/vote-distribution-chart.tsx` - æŠ•ç¥¨åˆ†å¸ƒãƒãƒ£ãƒ¼ãƒˆ
- `src/components/features/live-result-container.tsx` - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ã‚³ãƒ³ãƒ†ãƒŠ
- `src/components/features/csv-export-buttons.tsx` - CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒœã‚¿ãƒ³

---

## 8. Phase 5 å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½

### 8.1 å›½éš›åŒ–ï¼ˆi18nï¼‰

- [x] next-intl ã®å°å…¥
- [x] æ—¥æœ¬èª/è‹±èªãƒªã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆmessages/ja.json, en.jsonï¼‰
- [x] è¨€èªåˆ‡ã‚Šæ›¿ãˆUIï¼ˆlanguage-switcher.tsxï¼‰

### 8.2 ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ï¼ˆa11yï¼‰

- [x] WCAG 2.1 Level AA æº–æ‹ 
- [x] ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œå¯¾å¿œï¼ˆSkip to contentã€ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚¹ã‚¿ã‚¤ãƒ«ï¼‰
- [x] ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼å¯¾å¿œï¼ˆARIAå±æ€§ã€ä»£æ›¿ãƒ†ã‚­ã‚¹ãƒˆï¼‰
- [x] prefers-reduced-motionå¯¾å¿œ

### 8.3 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

- [x] ç”»åƒæœ€é©åŒ–ï¼ˆNext.js Imageï¼‰
- [x] ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ï¼ˆé™çš„ã‚¢ã‚»ãƒƒãƒˆã€Next.js staticï¼‰
- [x] å¤–éƒ¨ç”»åƒå¯¾å¿œï¼ˆremotePatternsè¨­å®šï¼‰

### 8.4 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–

- [x] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆX-Frame-Options, CSPç­‰ï¼‰
- [x] HSTSè¨­å®š
- [x] ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚¬ã‚¤ãƒ‰ï¼ˆdocs/DEPLOY.md - Upstash Redisæ¨å¥¨ï¼‰

### 8.5 ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸

- [x] å˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆ39ãƒ†ã‚¹ãƒˆï¼‰
- [x] E2Eãƒ†ã‚¹ãƒˆï¼ˆãƒ›ãƒ¼ãƒ ã€ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆã€æŠ•ç¥¨ãƒ•ãƒ­ãƒ¼ï¼‰

### 8.6 ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™

- [x] ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †æ›¸ï¼ˆdocs/DEPLOY.mdï¼‰
- [x] ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ï¼ˆdocs/USER_MANUAL.mdï¼‰
- [x] ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚¬ã‚¤ãƒ‰ï¼ˆCONTRIBUTING.mdï¼‰

### 8.7 ãƒ‡ãƒ—ãƒ­ã‚¤æº–å‚™

- [x] Vercelã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šï¼ˆvercel.jsonï¼‰
- [x] ç’°å¢ƒå¤‰æ•°ã‚¬ã‚¤ãƒ‰ï¼ˆdocs/DEPLOY.mdï¼‰

---

## 9. æŠ€è¡“çš„æ³¨æ„ç‚¹

### 9.1 èªè¨¼è¨­è¨ˆ

- **ä¸»å‚¬è€…**: èªè¨¼ä¸è¦ã€‚`Event.adminToken` ã§ã‚¤ãƒ™ãƒ³ãƒˆç·¨é›†æ¨©é™ã‚’åˆ¶å¾¡
- **æŠ•ç¥¨è€…ï¼ˆå€‹åˆ¥ï¼‰**: `AccessToken` ä»˜ãURLã§ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆãƒ­ã‚°ã‚¤ãƒ³ä¸è¦ï¼‰
- **æŠ•ç¥¨è€…ï¼ˆSocialï¼‰**: NextAuth.jsã«ã‚ˆã‚‹OAuthèªè¨¼ï¼ˆGoogle/LINEï¼‰

### 9.2 æŠ•ç¥¨èªè¨¼ãƒ•ãƒ­ãƒ¼

```typescript
// src/lib/auth/voting-auth.ts ã‚’ä½¿ç”¨
const authResult = await authenticateVoter(eventId, token);
if (!authResult.authenticated) {
  // ã‚¨ãƒ©ãƒ¼å‡¦ç†
}
if (authResult.type === "token") {
  // å€‹åˆ¥æŠ•ç¥¨ãƒ¢ãƒ¼ãƒ‰
} else {
  // Socialèªè¨¼ãƒ¢ãƒ¼ãƒ‰
}
```

### 9.3 ç’°å¢ƒå¤‰æ•°ï¼ˆèªè¨¼é–¢é€£ï¼‰

```env
# .env.example å‚ç…§
NEXTAUTH_URL="http://localhost:3000"
NEXTAUTH_SECRET="your-secret-key"
GOOGLE_CLIENT_ID=""
GOOGLE_CLIENT_SECRET=""
LINE_CHANNEL_ID=""
LINE_CHANNEL_SECRET=""
```

### 9.4 è¨­è¨ˆæ±ºå®šäº‹é …

1. ä¸»å‚¬è€…èªè¨¼: ãªã—ï¼ˆèª°ã§ã‚‚ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆå¯èƒ½ï¼‰
2. å†æŠ•ç¥¨: æŠ•ç¥¨æœŸé–“å†…ã¯ä½•åº¦ã§ã‚‚å¤‰æ›´å¯èƒ½ï¼ˆå¿…é ˆï¼‰
3. ãƒã‚¤ãƒŠã‚¹æŠ•ç¥¨: ãªã—ï¼ˆ0ä»¥ä¸Šã®ã¿ï¼‰
4. çµæœå…¬é–‹: å¸¸æ™‚ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å…¬é–‹

---

## 10. å‚ç…§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

| ãƒ•ã‚¡ã‚¤ãƒ«                  | å†…å®¹                                 |
| ------------------------- | ------------------------------------ |
| `development-plan.md`     | é–‹ç™ºè¨ˆç”»æ›¸ï¼ˆPhaseåˆ¥ã‚¿ã‚¹ã‚¯ä¸€è¦§ï¼‰      |
| `system-specification.md` | è¦ä»¶å®šç¾©æ›¸ï¼ˆæ©Ÿèƒ½è¦ä»¶ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ï¼‰ |
| `README.md`               | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ãƒ»ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †   |
| `CONTRIBUTING.md`         | ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚¬ã‚¤ãƒ‰           |
| `docs/DEPLOY.md`          | ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †æ›¸                       |
| `docs/USER_MANUAL.md`     | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ‹ãƒ¥ã‚¢ãƒ«                   |

---

**ä½œæˆæ—¥**: 2025å¹´11æœˆ26æ—¥  
**Phase 1 å®Œäº†æ—¥**: 2025å¹´11æœˆ26æ—¥  
**Phase 2 å®Œäº†æ—¥**: 2025å¹´11æœˆ26æ—¥  
**Phase 3 å®Œäº†æ—¥**: 2025å¹´11æœˆ26æ—¥  
**Phase 4 å®Œäº†æ—¥**: 2025å¹´11æœˆ26æ—¥  
**Phase 5 å®Œäº†æ—¥**: 2025å¹´11æœˆ26æ—¥  
**å…¨Phaseå®Œäº†** ğŸ‰
