# QV-Tool é–‹ç™ºå¼•ãç¶™ãè³‡æ–™

## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

**Quadratic Voting Tool (QV-Tool)** ã¯ã€äºŒæ¬¡æŠ•ç¥¨ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’ç”¨ã„ãŸæ°‘ä¸»çš„ãªæ„æ€æ±ºå®šãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚

### ç¾åœ¨ã®çŠ¶æ…‹
- **Phase 1: åŸºç›¤æ§‹ç¯‰** âœ… å®Œäº†
- **Phase 2: èªè¨¼ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†** ğŸ”² æœªç€æ‰‹
- **Phase 3: æŠ•ç¥¨æ©Ÿèƒ½** ğŸ”² æœªç€æ‰‹
- **Phase 4: é›†è¨ˆãƒ»çµæœè¡¨ç¤º** ğŸ”² æœªç€æ‰‹
- **Phase 5: å“è³ªå‘ä¸Šãƒ»æœ€é©åŒ–** ğŸ”² æœªç€æ‰‹

---

## 2. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| ã‚«ãƒ†ã‚´ãƒª | æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ |
|----------|------|------------|
| Framework | Next.js (App Router) | 16.0.4 |
| Language | TypeScript | ^5 |
| Styling | Tailwind CSS + Shadcn/ui | v4 |
| Database | PostgreSQL | 16-alpine |
| ORM | Prisma | 7.0.1 |
| Validation | Zod | ^4.1.13 |
| Auth | NextAuth.js (v5) | æœªå°å…¥ï¼ˆPhase 2ã§å°å…¥ï¼‰ |
| Test | Vitest + Playwright | å°å…¥æ¸ˆã¿ |

---

## 3. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
qv-tool/
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma          # DBã‚¹ã‚­ãƒ¼ãƒå®šç¾©ï¼ˆå…¨ãƒ¢ãƒ‡ãƒ«å®šç¾©æ¸ˆã¿ï¼‰
â”‚   â””â”€â”€ migrations/            # ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å±¥æ­´
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ (auth)/            # èªè¨¼é–¢é€£ãƒšãƒ¼ã‚¸ï¼ˆç©ºï¼‰
â”‚   â”‚   â”œâ”€â”€ (dashboard)/
â”‚   â”‚   â”‚   â””â”€â”€ admin/
â”‚   â”‚   â”‚       â”œâ”€â”€ create/    # ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆï¼ˆç©ºï¼‰
â”‚   â”‚   â”‚       â””â”€â”€ [id]/      # ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†ï¼ˆç©ºï¼‰
â”‚   â”‚   â”œâ”€â”€ events/
â”‚   â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚       â”œâ”€â”€ vote/      # æŠ•ç¥¨ç”»é¢ï¼ˆç©ºï¼‰
â”‚   â”‚   â”‚       â””â”€â”€ result/    # çµæœç”»é¢ï¼ˆç©ºï¼‰
â”‚   â”‚   â”œâ”€â”€ api/               # API Routesï¼ˆç©ºï¼‰
â”‚   â”‚   â”œâ”€â”€ globals.css        # ã‚°ãƒ­ãƒ¼ãƒãƒ«CSSï¼ˆãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼è¨­å®šæ¸ˆã¿ï¼‰
â”‚   â”‚   â”œâ”€â”€ layout.tsx         # ãƒ«ãƒ¼ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â”‚   â””â”€â”€ page.tsx           # ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ui/                # Shadcn/ui ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ label.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ select.tsx
â”‚   â”‚   â”‚   â””â”€â”€ textarea.tsx
â”‚   â”‚   â”œâ”€â”€ features/          # æ©Ÿèƒ½ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆç©ºï¼‰
â”‚   â”‚   â””â”€â”€ layout/            # ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆç©ºï¼‰
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ actions/           # Server Actionsï¼ˆç©ºï¼‰
â”‚   â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”‚   â””â”€â”€ index.ts       # Prisma Client ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”‚   â”œâ”€â”€ qv.ts          # QVè¨ˆç®—ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ â­
â”‚   â”‚   â”‚   â”œâ”€â”€ qv.test.ts     # QVè¨ˆç®—ãƒ†ã‚¹ãƒˆï¼ˆ7ä»¶ãƒ‘ã‚¹ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ utils.ts           # Shadcn/uiç”¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”‚   â””â”€â”€ validations/
â”‚   â”‚       â”œâ”€â”€ event.ts       # ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ â­
â”‚   â”‚       â”œâ”€â”€ subject.ts     # æŠ•ç¥¨å¯¾è±¡ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ â­
â”‚   â”‚       â”œâ”€â”€ vote.ts        # æŠ•ç¥¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ â­
â”‚   â”‚       â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ test/
â”‚   â”‚   â””â”€â”€ setup.ts           # Vitest ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
â”‚   â””â”€â”€ types/                 # å‹å®šç¾©ï¼ˆç©ºï¼‰
â”œâ”€â”€ .devcontainer/             # DevContainerè¨­å®š
â”œâ”€â”€ .github/workflows/
â”‚   â””â”€â”€ ci.yml                 # GitHub Actions CI
â”œâ”€â”€ .husky/
â”‚   â””â”€â”€ pre-commit             # ã‚³ãƒŸãƒƒãƒˆæ™‚lint
â”œâ”€â”€ docker-compose.yml         # PostgreSQL ã‚³ãƒ³ãƒ†ãƒŠ
â”œâ”€â”€ vitest.config.ts           # Vitestè¨­å®š
â”œâ”€â”€ playwright.config.ts       # Playwrightè¨­å®š
â”œâ”€â”€ development-plan.md        # é–‹ç™ºè¨ˆç”»æ›¸ â­
â””â”€â”€ system-specification.md    # è¦ä»¶å®šç¾©æ›¸ â­
```

---

## 4. ç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# 1. ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# 2. ç’°å¢ƒå¤‰æ•°è¨­å®š
cp .env.example .env
# .env ã‚’ç·¨é›†ï¼ˆDATABASE_URL ã¯è¨­å®šæ¸ˆã¿ï¼‰

# 3. DBã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•
docker-compose up -d

# 4. Prisma Clientç”Ÿæˆ & ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
npx prisma generate
npx prisma migrate dev

# 5. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
npm run dev
```

### ä¸»è¦ã‚³ãƒãƒ³ãƒ‰

| ã‚³ãƒãƒ³ãƒ‰ | èª¬æ˜ |
|----------|------|
| `npm run dev` | é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹• |
| `npm run build` | ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰ |
| `npm run lint` | ESLintå®Ÿè¡Œ |
| `npm run format` | Prettierå®Ÿè¡Œ |
| `npm run type-check` | TypeScriptãƒã‚§ãƒƒã‚¯ |
| `npm run test` | å˜ä½“ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ |
| `npm run test:e2e` | E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œ |
| `npm run db:studio` | Prisma Studioèµ·å‹• |
| `npm run db:migrate` | ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ |

---

## 5. å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½

### 5.1 Prisma ã‚¹ã‚­ãƒ¼ãƒï¼ˆå…¨ãƒ¢ãƒ‡ãƒ«å®šç¾©æ¸ˆã¿ï¼‰

```prisma
# ä¸»è¦ãƒ¢ãƒ‡ãƒ«
- User          # æŠ•ç¥¨è€…ï¼ˆSocial Authç”¨ï¼‰
- Event         # æŠ•ç¥¨ã‚¤ãƒ™ãƒ³ãƒˆ
- Subject       # æŠ•ç¥¨å¯¾è±¡
- Vote          # æŠ•ç¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
- VoteDetail    # æŠ•ç¥¨æ˜ç´°
- AccessToken   # å€‹åˆ¥æŠ•ç¥¨ç”¨ãƒˆãƒ¼ã‚¯ãƒ³
- Account/Session/VerificationToken  # NextAuthç”¨
```

### 5.2 QVè¨ˆç®—ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ (`src/lib/utils/qv.ts`)

```typescript
calculateCost(votes)           // ç¥¨æ•°â†’ã‚³ã‚¹ãƒˆï¼ˆvotesÂ²ï¼‰
calculateMaxVotes(credits)     // ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆâ†’æœ€å¤§ç¥¨æ•°
calculateTotalCost(votes[])    // ç·ã‚³ã‚¹ãƒˆè¨ˆç®—
calculateRemainingCredits()    // æ®‹ã‚Šã‚¯ãƒ¬ã‚¸ãƒƒãƒˆè¨ˆç®—
canChangeVote()                // æŠ•ç¥¨å¤‰æ›´å¯å¦ãƒã‚§ãƒƒã‚¯
```

### 5.3 Zodãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚­ãƒ¼ãƒ

- `createEventSchema` / `updateEventSchema`
- `createSubjectSchema` / `updateSubjectSchema`
- `submitVoteSchema` / `validateVoteCost()`

### 5.4 ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼

- **Primary**: é»’ `#000000` (oklch: `0 0 0`)
- **Secondary**: ã‚¤ã‚¨ãƒ­ãƒ¼ `#EDFF38` (oklch: `0.94 0.19 108`)
- ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œæ¸ˆã¿

---

## 6. Phase 2 ã§å®Ÿè£…ã™ã¹ãå†…å®¹

### 2.1 èªè¨¼åŸºç›¤ï¼ˆæŠ•ç¥¨è€…å‘ã‘ï¼‰
- [ ] NextAuth.js v5 å°å…¥
- [ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
- [ ] èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ä½œæˆ

### 2.2 Googleèªè¨¼
- [ ] Google OAuth 2.0 è¨­å®š
- [ ] èªè¨¼ãƒ•ãƒ­ãƒ¼å®Ÿè£…

### 2.3 LINEèªè¨¼
- [ ] LINE OpenID Connect è¨­å®š
- [ ] èªè¨¼ãƒ•ãƒ­ãƒ¼å®Ÿè£…

### 2.4 å€‹åˆ¥æŠ•ç¥¨èªè¨¼
- [ ] AccessTokenæ´»ç”¨
- [ ] ãƒ¦ãƒ‹ãƒ¼ã‚¯URLç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯
- [ ] ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢

### 2.5 ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†æ©Ÿèƒ½
- [ ] ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆãƒ•ã‚©ãƒ¼ãƒ UIï¼ˆèªè¨¼ä¸è¦ï¼‰
- [ ] Server Actionå®Ÿè£…
- [ ] adminTokenè‡ªå‹•ç”Ÿæˆ
- [ ] slugè‡ªå‹•/æ‰‹å‹•è¨­å®š
- [ ] ã‚¤ãƒ™ãƒ³ãƒˆç·¨é›†æ©Ÿèƒ½
- [ ] æŠ•ç¥¨é–‹å§‹å¾Œã®ç·¨é›†åˆ¶é™

### 2.6 æŠ•ç¥¨å¯¾è±¡ç®¡ç†
- [ ] Subject CRUD UI
- [ ] ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆVercel Blobæ¨å¥¨ï¼‰
- [ ] è¡¨ç¤ºé †åºç®¡ç†

### 2.7 å€‹åˆ¥æŠ•ç¥¨ç”¨ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†
- [ ] ãƒˆãƒ¼ã‚¯ãƒ³ä¸€æ‹¬ç”Ÿæˆ
- [ ] CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

---

## 7. æŠ€è¡“çš„æ³¨æ„ç‚¹

### 7.1 èªè¨¼è¨­è¨ˆ
- **ä¸»å‚¬è€…**: èªè¨¼ä¸è¦ã€‚`Event.adminToken` ã§ã‚¤ãƒ™ãƒ³ãƒˆç·¨é›†æ¨©é™ã‚’åˆ¶å¾¡
- **æŠ•ç¥¨è€…ï¼ˆå€‹åˆ¥ï¼‰**: `AccessToken` ä»˜ãURLã§ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆãƒ­ã‚°ã‚¤ãƒ³ä¸è¦ï¼‰
- **æŠ•ç¥¨è€…ï¼ˆSocialï¼‰**: NextAuth.jsã«ã‚ˆã‚‹OAuthèªè¨¼

### 7.2 Prisma 7 ã®æ³¨æ„ç‚¹
- `datasource.url` ã¯ `prisma.config.ts` ã«ç§»å‹•æ¸ˆã¿
- `schema.prisma` ã«ã¯ `provider` ã®ã¿è¨˜è¼‰

### 7.3 è¨­è¨ˆæ±ºå®šäº‹é …
1. ä¸»å‚¬è€…èªè¨¼: ãªã—ï¼ˆèª°ã§ã‚‚ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆå¯èƒ½ï¼‰
2. å†æŠ•ç¥¨: æŠ•ç¥¨æœŸé–“å†…ã¯ä½•åº¦ã§ã‚‚å¤‰æ›´å¯èƒ½ï¼ˆå¿…é ˆï¼‰
3. ãƒã‚¤ãƒŠã‚¹æŠ•ç¥¨: ãªã—ï¼ˆ0ä»¥ä¸Šã®ã¿ï¼‰
4. çµæœå…¬é–‹: å¸¸æ™‚ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å…¬é–‹

---

## 8. å‚ç…§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

| ãƒ•ã‚¡ã‚¤ãƒ« | å†…å®¹ |
|----------|------|
| `development-plan.md` | é–‹ç™ºè¨ˆç”»æ›¸ï¼ˆPhaseåˆ¥ã‚¿ã‚¹ã‚¯ä¸€è¦§ï¼‰ |
| `system-specification.md` | è¦ä»¶å®šç¾©æ›¸ï¼ˆæ©Ÿèƒ½è¦ä»¶ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ï¼‰ |
| `README.md` | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ãƒ»ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é † |

---

**ä½œæˆæ—¥**: 2025å¹´11æœˆ26æ—¥  
**Phase 1 å®Œäº†æ—¥**: 2025å¹´11æœˆ26æ—¥

